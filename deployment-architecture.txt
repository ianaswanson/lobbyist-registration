================================================================================
                   CLOUD BUILD DEPLOYMENT ARCHITECTURE
================================================================================

DEVELOPMENT ENVIRONMENT (Auto-Deploy)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚                  â”‚      â”‚                 â”‚
â”‚   GitHub    â”‚      â”‚   Cloud Build    â”‚      â”‚   Cloud Run     â”‚
â”‚  (develop)  â”‚â”€â”€â”€â”€â”€â”€â–¶   (Triggered)    â”‚â”€â”€â”€â”€â”€â”€â–¶   Development   â”‚
â”‚             â”‚ push â”‚                  â”‚deployâ”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”‚ Runs pipeline:
                              â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                 â”‚
                     â”‚  1. npm ci      â”‚
                     â”‚  2. Type check  â”‚
                     â”‚  3. Security    â”‚
                     â”‚     scan        â”‚
                     â”‚  4. Build image â”‚
                     â”‚  5. Push to GCR â”‚
                     â”‚  6. Deploy      â”‚
                     â”‚  7. Verify      â”‚
                     â”‚                 â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      âœ… Auto-deployed
                      ~5 minutes total

Service URL: https://lobbyist-registration-dev-zzp44w3snq-uw.a.run.app


PRODUCTION ENVIRONMENT (Manual Approval)
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             â”‚      â”‚                  â”‚      â”‚             â”‚
â”‚   GitHub    â”‚      â”‚   Cloud Build    â”‚      â”‚   WAITING   â”‚
â”‚    (main)   â”‚â”€â”€â”€â”€â”€â”€â–¶   (Triggered)    â”‚â”€â”€â”€â”€â”€â”€â–¶   FOR YOU   â”‚
â”‚             â”‚ push â”‚                  â”‚      â”‚  TO APPROVE â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚                        â”‚
                              â”‚ Runs validation:       â”‚
                              â”‚                        â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
                     â”‚                 â”‚               â”‚
                     â”‚  1. npm ci      â”‚               â”‚
                     â”‚  2. Type check  â”‚               â”‚
                     â”‚  3. Security    â”‚               â”‚
                     â”‚     audit       â”‚               â”‚
                     â”‚     (strict)    â”‚               â”‚
                     â”‚  4. Validate    â”‚               â”‚
                     â”‚     schema      â”‚               â”‚
                     â”‚  5. Build image â”‚               â”‚
                     â”‚  6. Scan image  â”‚               â”‚
                     â”‚  7. Push to GCR â”‚               â”‚
                     â”‚                 â”‚               â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                              â”‚                        â”‚
                              â–¼                        â”‚
                    â¸ï¸  PAUSED FOR APPROVAL â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         (You review)
                              â”‚
                              â”‚ You approve in console
                              â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚                 â”‚
                     â”‚  8. Tag image   â”‚
                     â”‚  9. Deploy      â”‚
                     â”‚     (no traffic)â”‚
                     â”‚ 10. Health      â”‚
                     â”‚     check       â”‚
                     â”‚ 11. Route       â”‚
                     â”‚     traffic     â”‚
                     â”‚ 12. Verify      â”‚
                     â”‚                 â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                      âœ… Deployed to production
                      ~10 minutes total

Service URL: https://lobbyist-registration-zzp44w3snq-uw.a.run.app


ROLLBACK PROCEDURE
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                               â”‚
â”‚  Production has multiple revisions (blue-green deployment):  â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Revision A  â”‚  â”‚  Revision B  â”‚  â”‚  Revision C  â”‚       â”‚
â”‚  â”‚  (previous)  â”‚  â”‚  (previous)  â”‚  â”‚  (current)   â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  100% trafficâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                              â”‚                â”‚
â”‚                                              â”‚ If broken      â”‚
â”‚                                              â–¼                â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚                            â”‚  Rollback to Revision B â”‚        â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                              â”‚                â”‚
â”‚                                              â–¼                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Revision A  â”‚  â”‚  Revision B  â”‚  â”‚  Revision C  â”‚       â”‚
â”‚  â”‚              â”‚  â”‚  100% trafficâ”‚  â”‚  (removed)   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Command:
  gcloud run services update-traffic lobbyist-registration \
    --region=us-west1 \
    --to-revisions=REVISION_B=100


COMPARISON: Connect Repo vs Cloud Build
================================================================================

CONNECT REPO (Simple but Risky):

  GitHub â”€â”€â”€â”€â”€â”€â–¶ Cloud Run
  (main)      instant deploy
                    â”‚
                    â–¼
              âŒ NO VALIDATION
              âŒ NO APPROVAL
              âŒ NO AUDIT TRAIL
              âŒ RISKY FOR PRODUCTION


CLOUD BUILD TRIGGERS (Recommended):

  GitHub â”€â”€â”€â”€â”€â”€â–¶ Cloud Build â”€â”€â”€â”€â”€â”€â–¶ [APPROVAL] â”€â”€â”€â”€â”€â”€â–¶ Cloud Run
  (main)      validate/build      you review       safe deploy
                    â”‚                                     â”‚
                    â”‚                                     â–¼
                    â”‚                            âœ… VALIDATED
                    â–¼                            âœ… APPROVED
              âœ… TYPE CHECK                      âœ… AUDITABLE
              âœ… SECURITY SCAN                   âœ… SAFE
              âœ… BUILD LOGS
              âœ… AUDIT TRAIL


SECURITY MODEL
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚  Cloud Build Service Account                                     â”‚
â”‚  (runs with least-privilege permissions)                         â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚  â”‚  Permissions:   â”‚                                             â”‚
â”‚  â”‚                 â”‚                                             â”‚
â”‚  â”‚  âœ… Deploy to   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚  â”‚    Cloud Run    â”‚          â”‚                                  â”‚
â”‚  â”‚                 â”‚          â”‚                                  â”‚
â”‚  â”‚  âœ… Push to     â”‚          â”‚                                  â”‚
â”‚  â”‚    Container    â”‚          â”‚                                  â”‚
â”‚  â”‚    Registry     â”‚          â–¼                                  â”‚
â”‚  â”‚                 â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚  âœ… Access      â”‚    â”‚              â”‚                         â”‚
â”‚  â”‚    Secret       â”‚â”€â”€â”€â”€â”‚  Cloud Run   â”‚                         â”‚
â”‚  â”‚    Manager      â”‚    â”‚  Production  â”‚                         â”‚
â”‚  â”‚                 â”‚    â”‚              â”‚                         â”‚
â”‚  â”‚  âŒ No access   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚  â”‚    to user      â”‚                                             â”‚
â”‚  â”‚    data or      â”‚                                             â”‚
â”‚  â”‚    billing      â”‚                                             â”‚
â”‚  â”‚                 â”‚                                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                                   â”‚
â”‚  ğŸ”’ No GCP credentials stored in GitHub                          â”‚
â”‚  ğŸ”’ All secrets in Secret Manager (encrypted at rest)            â”‚
â”‚  ğŸ”’ Audit logs capture every action                              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


COST BREAKDOWN
================================================================================

Cloud Build Free Tier: 120 build-minutes/day

Your expected usage:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Environment      â”‚ Frequency    â”‚ Build Time  â”‚ Monthly Use  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Development      â”‚ 2-3/day      â”‚ 5 min       â”‚ 300-450 min  â”‚
â”‚ Production       â”‚ 1-2/week     â”‚ 7 min       â”‚ 28-56 min    â”‚
â”‚ Total            â”‚              â”‚             â”‚ ~500 min     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Free tier capacity: 3,600 min/month
Your usage:          ~500 min/month
Remaining:          3,100 min/month

COST: $0 (within free tier) ğŸ’°


AUDIT TRAIL EXAMPLE
================================================================================

Every deployment captures:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Deployment Record ID: 2025-10-21-143022-abc123                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WHO:                                                             â”‚
â”‚   GitHub User: ianaswanson                                       â”‚
â”‚   Service Account: cloudbuild@project.iam.gserviceaccount.com   â”‚
â”‚   Approver: ianaswanson (production only)                        â”‚
â”‚                                                                  â”‚
â”‚ WHAT:                                                            â”‚
â”‚   Commit: abc123def456                                           â”‚
â”‚   Branch: main                                                   â”‚
â”‚   Files Changed: 5 files                                         â”‚
â”‚   Lines: +127, -43                                               â”‚
â”‚                                                                  â”‚
â”‚ WHEN:                                                            â”‚
â”‚   Triggered: 2025-10-21 14:30:22 UTC                             â”‚
â”‚   Approved: 2025-10-21 14:35:15 UTC                              â”‚
â”‚   Deployed: 2025-10-21 14:40:33 UTC                              â”‚
â”‚                                                                  â”‚
â”‚ WHY:                                                             â”‚
â”‚   Commit Message: "feat: Add new expense category field"        â”‚
â”‚                                                                  â”‚
â”‚ HOW:                                                             â”‚
â”‚   Build Steps: 13 steps (all passed)                             â”‚
â”‚   Image: gcr.io/project/lobbyist-registration:abc123            â”‚
â”‚   Revision: lobbyist-registration-00042-xyz                      â”‚
â”‚                                                                  â”‚
â”‚ RESULT:                                                          â”‚
â”‚   Status: âœ… SUCCESS                                             â”‚
â”‚   Health Check: âœ… PASSED                                        â”‚
â”‚   Traffic: 100% to new revision                                  â”‚
â”‚                                                                  â”‚
â”‚ LOGS:                                                            â”‚
â”‚   Build: https://console.cloud.google.com/build/abc123          â”‚
â”‚   Service: https://console.cloud.google.com/run/detail/...      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

This audit trail is retained for 90 days and can be exported for
compliance reports required by Multnomah County.


NEXT STEPS
================================================================================

1. Read DEPLOYMENT-RECOMMENDATION.md for complete details

2. Connect GitHub repository to Cloud Build

3. Run setup script:
   cd /Users/ianswanson/ai-dev/lobbyist-registration
   ./setup-cloud-build-triggers.sh

4. Test development deployment

5. Test production approval workflow

6. Document any project-specific customizations


================================================================================
